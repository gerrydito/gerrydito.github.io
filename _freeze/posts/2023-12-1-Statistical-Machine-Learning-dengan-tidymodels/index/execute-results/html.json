{
  "hash": "56739f0c04d1a302899b14844d5487cb",
  "result": {
    "markdown": "---\ntitle: \"Statistical Machine Learning dengan `tidymodels`\"\ndate: 12-1-2023\nauthor: Gerry Alfa Dito\ncategories: \n      - R Programming\n      - Statistical Machine Learning\n      - tidymodels\ndraft: false\nimage: post-image.jpg\n---\n\n\n\nR memiliki beberapa ekosistem yang bisa digunakan untuk menerapkan statistical machine learning, seperti\n\na. `tidymodels` | [read more](https://www.tidymodels.org/)\nb. `mlr3` | [read more](https://mlr3.mlr-org.com/)\nc. `caret` | [read more](http://topepo.github.io/caret/index.html)\n\nManfaat dari ekosistem-ekosistem ini adalah menggabungkan model-model statistical machine lerning yang berasal dari berbagai macam package sehingga mudah untuk digunakan karena sintaksnya yang seragam. \n\nPada tulisan ini kita akan menggunakan ekosistem `tidymodels` untuk menerapkan statistical machine learning. Jika tertarik belajar lebih lanjut tentang `tidymodels` bisa membuka sumber-sumber berikut\n\na. Buku [Tidy Modeling with R](https://www.tmwr.org/)\nb. Website [Learning tidymodels](https://www.tidymodels.org/learn/)\nc. Youtube Playlist [TidyX - tidymodels](https://youtube.com/playlist?list=PLdb0LTjA9iQyCgTd8MmRS38vYrRIzdx2j&si=w28XqdooRLMTq9s-)\n\n\n## Machine learning Workflow\n\n![](Machine Learning Pipeline.png)\n\n## Data\n\nThis dataset classifies people described by a set of attributes as good or bad credit risks.\n\nAuthor: Dr. Hans Hofmann Source: UCI - 1994 Please cite: Dua, D. and Graff, C. (2019). UCI Machine Learning Repository [http://archive.ics.uci.edu/ml]. Irvine, CA: University of California, School of Information and Computer Science.\n\nAttribute description\n\n- Status of existing checking account, in Deutsche Mark.\n- Credit history (credits taken, paid back duly, delays, critical accounts)\n- Purpose of the credit (car, television,…)\n- Credit amount\n- Status of savings account/bonds, in Deutsche Mark.\n- Present employment, in number of years.\n- Installment rate in percentage of disposable income\n- Personal status (married, single,…) and sex\n- Other debtors / guarantors\n- Present residence since X years\n- Property (e.g. real estate)\n- Age in years\n- Other installment plans (banks, stores)\n- Housing (rent, own,…)\n- Number of existing credits at this bank\n- Job\n- Number of people being liable to provide maintenance for\n- Telephone (yes,no)\n- Foreign worker (yes,no)\n- Duration in months\n\ndata bisa didownload pada link berikut:\n\n[download data](https://drive.google.com/file/d/1NzVo6uhpUVuccRCUyTAN6RTAmp8YkAaw/view?usp=share_link)\n\n\n## Package\n\n\n \n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"rpart\")\ninstall.packages(\"ranger\")\n```\n:::\n\n\nPackage diatas harus dinstall tapi tidak perlu dipanggil menggunakan `library`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(skimr)\nlibrary(DataExplorer)\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(rpart.plot)\n```\n:::\n\n\n\n\n## Import Data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- read.csv(\"german_credit.csv\",stringsAsFactors = TRUE)\nglimpse(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 1,000\nColumns: 21\n$ checking_status        <fct> '<0', '0<=X<200', 'no checking', '<0', '<0', 'n…\n$ duration               <int> 6, 48, 12, 42, 24, 36, 24, 36, 12, 30, 12, 48, …\n$ credit_history         <fct> 'critical/other existing credit', 'existing pai…\n$ purpose                <fct> radio/tv, radio/tv, education, furniture/equipm…\n$ credit_amount          <int> 1169, 5951, 2096, 7882, 4870, 9055, 2835, 6948,…\n$ savings_status         <fct> 'no known savings', '<100', '<100', '<100', '<1…\n$ employment             <fct> '>=7', '1<=X<4', '4<=X<7', '4<=X<7', '1<=X<4', …\n$ installment_commitment <int> 4, 2, 2, 2, 3, 2, 3, 2, 2, 4, 3, 3, 1, 4, 2, 4,…\n$ personal_status        <fct> 'male single', 'female div/dep/mar', 'male sing…\n$ other_parties          <fct> none, none, none, guarantor, none, none, none, …\n$ residence_since        <int> 4, 2, 3, 4, 4, 4, 4, 2, 4, 2, 1, 4, 1, 4, 4, 2,…\n$ property_magnitude     <fct> 'real estate', 'real estate', 'real estate', 'l…\n$ age                    <int> 67, 22, 49, 45, 53, 35, 53, 35, 61, 28, 25, 24,…\n$ other_payment_plans    <fct> none, none, none, none, none, none, none, none,…\n$ housing                <fct> own, own, own, 'for free', 'for free', 'for fre…\n$ existing_credits       <int> 2, 1, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1,…\n$ job                    <fct> skilled, skilled, 'unskilled resident', skilled…\n$ num_dependents         <int> 1, 1, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…\n$ own_telephone          <fct> yes, none, none, none, none, yes, none, yes, no…\n$ foreign_worker         <fct> yes, yes, yes, yes, yes, yes, yes, yes, yes, ye…\n$ class                  <fct> good, bad, good, good, bad, good, good, good, g…\n```\n:::\n:::\n\n\n\n## Eksplorasi Data\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_intro(df,ggtheme = theme_classic())\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n\n### Eksploarasi Variabel Respon\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>% \ncount(class) %>% \nmutate(percent=n*100/sum(n),label=str_c(round(percent,2),\"%\")) %>% \nggplot(aes(x=\"\",y=n,fill=class))+\n  geom_col()+\n  geom_text(aes(label = label),\n            position = position_stack(vjust = 0.5)) +\n  coord_polar(theta = \"y\")+\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n\n### Eksplorasi Secara Numerik\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nskim_without_charts(df)\n```\n\n::: {.cell-output-display}\nTable: Data summary\n\n|                         |     |\n|:------------------------|:----|\n|Name                     |df   |\n|Number of rows           |1000 |\n|Number of columns        |21   |\n|_______________________  |     |\n|Column type frequency:   |     |\n|factor                   |14   |\n|numeric                  |7    |\n|________________________ |     |\n|Group variables          |None |\n\n\n**Variable type: factor**\n\n|skim_variable       | n_missing| complete_rate|ordered | n_unique|top_counts                             |\n|:-------------------|---------:|-------------:|:-------|--------:|:--------------------------------------|\n|checking_status     |         0|             1|FALSE   |        4|'no: 394, '<0: 274, '0<: 269, '>=: 63  |\n|credit_history      |         0|             1|FALSE   |        5|'ex: 530, 'cr: 293, 'de: 88, 'al: 49   |\n|purpose             |         0|             1|FALSE   |       10|rad: 280, 'ne: 234, fur: 181, 'us: 103 |\n|savings_status      |         0|             1|FALSE   |        5|'<1: 603, 'no: 183, '10: 103, '50: 63  |\n|employment          |         0|             1|FALSE   |        5|'1<: 339, '>=: 253, '4<: 174, '<1: 172 |\n|personal_status     |         0|             1|FALSE   |        4|'ma: 548, 'fe: 310, 'ma: 92, 'ma: 50   |\n|other_parties       |         0|             1|FALSE   |        3|non: 907, gua: 52, 'co: 41             |\n|property_magnitude  |         0|             1|FALSE   |        4|car: 332, 're: 282, 'li: 232, 'no: 154 |\n|other_payment_plans |         0|             1|FALSE   |        3|non: 814, ban: 139, sto: 47            |\n|housing             |         0|             1|FALSE   |        3|own: 713, ren: 179, 'fo: 108           |\n|job                 |         0|             1|FALSE   |        4|ski: 630, 'un: 200, 'hi: 148, 'un: 22  |\n|own_telephone       |         0|             1|FALSE   |        2|non: 596, yes: 404                     |\n|foreign_worker      |         0|             1|FALSE   |        2|yes: 963, no: 37                       |\n|class               |         0|             1|FALSE   |        2|goo: 700, bad: 300                     |\n\n\n**Variable type: numeric**\n\n|skim_variable          | n_missing| complete_rate|    mean|      sd|  p0|    p25|    p50|     p75|  p100|\n|:----------------------|---------:|-------------:|-------:|-------:|---:|------:|------:|-------:|-----:|\n|duration               |         0|             1|   20.90|   12.06|   4|   12.0|   18.0|   24.00|    72|\n|credit_amount          |         0|             1| 3271.26| 2822.74| 250| 1365.5| 2319.5| 3972.25| 18424|\n|installment_commitment |         0|             1|    2.97|    1.12|   1|    2.0|    3.0|    4.00|     4|\n|residence_since        |         0|             1|    2.85|    1.10|   1|    2.0|    3.0|    4.00|     4|\n|age                    |         0|             1|   35.55|   11.38|  19|   27.0|   33.0|   42.00|    75|\n|existing_credits       |         0|             1|    1.41|    0.58|   1|    1.0|    1.0|    2.00|     4|\n|num_dependents         |         0|             1|    1.16|    0.36|   1|    1.0|    1.0|    1.00|     2|\n:::\n:::\n\n\n\n### Eksplorasi Hubungan prediktor kategorik dengan respon\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_bar(data = df,by = \"class\",\n         ggtheme = theme_classic(),\n         ncol = 2)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-3.png){width=672}\n:::\n:::\n\n\n\n\n### Eksplorasi Hubungan prediktor kontinu dengan respon\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_boxplot(data = df,by = \"class\",\n         ggtheme = theme_classic(),\n         geom_boxplot_args = list(fill=\"#03A9F4\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n### Eksploarsi Hubungan antar Prediktor Kontinu\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_correlation(data = df,\n                 type = \"continuous\",\n                 cor_args = list(method=\"spearman\"),\n                 ggtheme = theme_classic(),\n                 theme_config = list(legend.position = \"none\",\n                                     axis.text.x=element_text(angle = 90)))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n\n## Praproses Data\n\n\nDalam ekosistem `tidymodels`, praproses data dapat dilakukan dengan package `recipe`([read more](https://recipes.tidymodels.org/)) dan juga turunannya seperti:\n\n* package [`themis`](https://themis.tidymodels.org/) untuk menangani masalah class imbalanced\n* package [`embed`](https://embed.tidymodels.org/) untuk predictors transformation (encoding)\n* package [`textrecipes`](https://textrecipes.tidymodels.org/) untuk praproses text data\n\nTahap praproses data terdiri dari\n\n* **Data Cleaning**. Menangani Missing Value, outlier, duplikasi data dan kesalahan input data.\n* **Feature Engineering**. **Feature Engineering** adalah proses transformasi data mentah menjadi suatu fitur yang lebih baik dalam merepresentasikan pola yang terkandung di dalam data, sehingga dapat meningkatkan performa model.\n\nBerikut adalah ilustrasi penggunaan package recipe untuk **Feature Engineering**. \n\n> Disclaimer: praproses di bawah hanya diperuntukan untuk ilustrasi penggunaan package `recipe` saja sehingga tidak memiliki alasan khusus kenapa di terapan tahapan praproses dibawah ini.\n\n\n### Tanpa Praproses\n\nKita hanya perlu menuliskan fungsi `recipe` dari package `recipe` dengan argumen `formula` dan `data`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nno_preproc <- recipe(formula=class~.,data = df)\n```\n:::\n\n\n\n### Dengan Praproses\n\n\nKita perlu menambahkan fungsi `step_*` setelah fungsi `recipe`. Dalam ilustrasi ini, kita akan mereduksi dimensi seluruh variabel prediktor kontinu ke 3 dimensi saja dengan metode **PCA**. Hal ini dapat dicapai dengan menggunakan fungsi `step_pca`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbasic_prepoc <- recipe(class~.,data = df) %>% \n  step_pca(all_numeric_predictors(),\n           num_comp = 3,\n           options = list(center = TRUE,\n                          scale. = TRUE))\n```\n:::\n\n\n\n* fungsi `all_numeric_predictors()` menandakan bahwa variabel yang akan direduksi adalah semua variabel prediktor kontinu\n* `num_comp=3` berarti kita akan mereduksi dimensi menjadi 3 dimensi\n* `options = list(center = TRUE,scale. = TRUE)` berarti sebelum direduksi dimensi variabel asalnya kita rubah menjadi variabel-variabel yang memiliki rata-rata yang mendekati 0 dan standar deviasi mendekati 1.\n\n\n\nKemudian, kita bisa memeriksa bagaimana hasi praproses dengan menggunakan fungsi `prep` dan `bake` seperti dibawah ini\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## memeriksa hasil praproses\nbasic_prepoc %>% \n  prep() %>% \n  bake(new_data = NULL)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1,000 × 17\n   checking_status credit_history              purpose savings_status employment\n   <fct>           <fct>                       <fct>   <fct>          <fct>     \n 1 '<0'            'critical/other existing c… radio/… 'no known sav… '>=7'     \n 2 '0<=X<200'      'existing paid'             radio/… '<100'         '1<=X<4'  \n 3 'no checking'   'critical/other existing c… educat… '<100'         '4<=X<7'  \n 4 '<0'            'existing paid'             furnit… '<100'         '4<=X<7'  \n 5 '<0'            'delayed previously'        'new c… '<100'         '1<=X<4'  \n 6 'no checking'   'existing paid'             educat… 'no known sav… '1<=X<4'  \n 7 'no checking'   'existing paid'             furnit… '500<=X<1000'  '>=7'     \n 8 '0<=X<200'      'existing paid'             'used … '<100'         '1<=X<4'  \n 9 'no checking'   'existing paid'             radio/… '>=1000'       '4<=X<7'  \n10 '0<=X<200'      'critical/other existing c… 'new c… '<100'         unemployed\n# ℹ 990 more rows\n# ℹ 12 more variables: personal_status <fct>, other_parties <fct>,\n#   property_magnitude <fct>, other_payment_plans <fct>, housing <fct>,\n#   job <fct>, own_telephone <fct>, foreign_worker <fct>, class <fct>,\n#   PC1 <dbl>, PC2 <dbl>, PC3 <dbl>\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n## memeriksa hasil praproses\nbasic_prepoc %>% \n  prep() %>% \n  bake(new_data = NULL) %>% \n  glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 1,000\nColumns: 17\n$ checking_status     <fct> '<0', '0<=X<200', 'no checking', '<0', '<0', 'no c…\n$ credit_history      <fct> 'critical/other existing credit', 'existing paid',…\n$ purpose             <fct> radio/tv, radio/tv, education, furniture/equipment…\n$ savings_status      <fct> 'no known savings', '<100', '<100', '<100', '<100'…\n$ employment          <fct> '>=7', '1<=X<4', '4<=X<7', '4<=X<7', '1<=X<4', '1<…\n$ personal_status     <fct> 'male single', 'female div/dep/mar', 'male single'…\n$ other_parties       <fct> none, none, none, guarantor, none, none, none, non…\n$ property_magnitude  <fct> 'real estate', 'real estate', 'real estate', 'life…\n$ other_payment_plans <fct> none, none, none, none, none, none, none, none, no…\n$ housing             <fct> own, own, own, 'for free', 'for free', 'for free',…\n$ job                 <fct> skilled, skilled, 'unskilled resident', skilled, s…\n$ own_telephone       <fct> yes, none, none, none, none, yes, none, yes, none,…\n$ foreign_worker      <fct> yes, yes, yes, yes, yes, yes, yes, yes, yes, yes, …\n$ class               <fct> good, bad, good, good, bad, good, good, good, good…\n$ PC1                 <dbl> -1.4374699, 2.2597114, -0.5184279, 2.6376242, 0.74…\n$ PC2                 <dbl> 2.7622605, -1.8069247, 1.2076170, 1.3624068, 2.734…\n$ PC3                 <dbl> -0.80190159, -0.09224456, 1.86397366, 1.01548818, …\n```\n:::\n:::\n\n\n\nSelanjutnya kita dapat menambahkan tahap praproses lain dengan menuliskan fungsi `step_*` lainnya. Sebagai ilustrasi kita akan mereduksi banyaknya kategori di variabel `purpose` dengan menyatukan beberapa kategori yang memiliki frekuensi sedikit\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>% \n  count(purpose) %>% \n  arrange(n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                purpose   n\n1            retraining   9\n2  'domestic appliance'  12\n3                 other  12\n4               repairs  22\n5             education  50\n6              business  97\n7            'used car' 103\n8   furniture/equipment 181\n9             'new car' 234\n10             radio/tv 280\n```\n:::\n:::\n\n\nMisal kita akan menggabungkan kategori yang memiliki frekuensi dibawah 50. Berdasarkan output diatas, maka kategori yang akan digabungkan adalah kategori `retraining`,`domestic appliance`, `other` dan `repairs`.\n\n\nKita bisa mereduksi banyaknya kategori dalam suatu variabel kategorik dengan fungsi `step_other`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbasic_prepoc <- basic_prepoc %>% \n                step_other(purpose,threshold = 50)\n```\n:::\n\n\n* `threshold = 50` berarti kategori yang memiliki frekuensi dibawah 50 akan digabung.\n\n\nBerikut adalah hasil praprosesnya\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## memeriksa hasil praproses\nbasic_prepoc %>% \n  prep() %>% \n  bake(new_data = NULL) %>% \n  glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 1,000\nColumns: 17\n$ checking_status     <fct> '<0', '0<=X<200', 'no checking', '<0', '<0', 'no c…\n$ credit_history      <fct> 'critical/other existing credit', 'existing paid',…\n$ purpose             <fct> radio/tv, radio/tv, education, furniture/equipment…\n$ savings_status      <fct> 'no known savings', '<100', '<100', '<100', '<100'…\n$ employment          <fct> '>=7', '1<=X<4', '4<=X<7', '4<=X<7', '1<=X<4', '1<…\n$ personal_status     <fct> 'male single', 'female div/dep/mar', 'male single'…\n$ other_parties       <fct> none, none, none, guarantor, none, none, none, non…\n$ property_magnitude  <fct> 'real estate', 'real estate', 'real estate', 'life…\n$ other_payment_plans <fct> none, none, none, none, none, none, none, none, no…\n$ housing             <fct> own, own, own, 'for free', 'for free', 'for free',…\n$ job                 <fct> skilled, skilled, 'unskilled resident', skilled, s…\n$ own_telephone       <fct> yes, none, none, none, none, yes, none, yes, none,…\n$ foreign_worker      <fct> yes, yes, yes, yes, yes, yes, yes, yes, yes, yes, …\n$ class               <fct> good, bad, good, good, bad, good, good, good, good…\n$ PC1                 <dbl> -1.4374699, 2.2597114, -0.5184279, 2.6376242, 0.74…\n$ PC2                 <dbl> 2.7622605, -1.8069247, 1.2076170, 1.3624068, 2.734…\n$ PC3                 <dbl> -0.80190159, -0.09224456, 1.86397366, 1.01548818, …\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n## memeriksa hasil praproses\nbasic_prepoc %>% \n  prep() %>% \n  bake(new_data = NULL) %>% \n  count(purpose) %>% \n  arrange(n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 7 × 2\n  purpose                 n\n  <fct>               <int>\n1 education              50\n2 other                  55\n3 business               97\n4 'used car'            103\n5 furniture/equipment   181\n6 'new car'             234\n7 radio/tv              280\n```\n:::\n:::\n\n\n\natau kita bisa menuliskan sintaksnya secara langsung\n \n \n\n::: {.cell}\n\n```{.r .cell-code}\nbasic_prepoc <- recipe(class~.,data = df) %>% \n  step_pca(all_numeric_predictors(),\n           num_comp = 3,\n           options = list(center = TRUE,\n                          scale. = TRUE)) %>% \n  step_other(purpose,threshold = 50)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n## memeriksa hasil praproses\nbasic_prepoc %>% \n  prep() %>% \n  bake(new_data = NULL) %>% \n  glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 1,000\nColumns: 17\n$ checking_status     <fct> '<0', '0<=X<200', 'no checking', '<0', '<0', 'no c…\n$ credit_history      <fct> 'critical/other existing credit', 'existing paid',…\n$ purpose             <fct> radio/tv, radio/tv, education, furniture/equipment…\n$ savings_status      <fct> 'no known savings', '<100', '<100', '<100', '<100'…\n$ employment          <fct> '>=7', '1<=X<4', '4<=X<7', '4<=X<7', '1<=X<4', '1<…\n$ personal_status     <fct> 'male single', 'female div/dep/mar', 'male single'…\n$ other_parties       <fct> none, none, none, guarantor, none, none, none, non…\n$ property_magnitude  <fct> 'real estate', 'real estate', 'real estate', 'life…\n$ other_payment_plans <fct> none, none, none, none, none, none, none, none, no…\n$ housing             <fct> own, own, own, 'for free', 'for free', 'for free',…\n$ job                 <fct> skilled, skilled, 'unskilled resident', skilled, s…\n$ own_telephone       <fct> yes, none, none, none, none, yes, none, yes, none,…\n$ foreign_worker      <fct> yes, yes, yes, yes, yes, yes, yes, yes, yes, yes, …\n$ class               <fct> good, bad, good, good, bad, good, good, good, good…\n$ PC1                 <dbl> -1.4374699, 2.2597114, -0.5184279, 2.6376242, 0.74…\n$ PC2                 <dbl> 2.7622605, -1.8069247, 1.2076170, 1.3624068, 2.734…\n$ PC3                 <dbl> -0.80190159, -0.09224456, 1.86397366, 1.01548818, …\n```\n:::\n\n```{.r .cell-code}\nbasic_prepoc %>% \n  prep() %>% \n  bake(new_data = NULL) %>% \n  count(purpose)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 7 × 2\n  purpose                 n\n  <fct>               <int>\n1 'new car'             234\n2 'used car'            103\n3 business               97\n4 education              50\n5 furniture/equipment   181\n6 radio/tv              280\n7 other                  55\n```\n:::\n:::\n\n\nFungsi `step_*` lainnya bisa diakses pada [website `recipe` berikut ini](https://recipes.tidymodels.org/reference/index.html)\n\n## Model Training and Evaluation\n\nTahap ini harusnya berada di dalam Tahap Model Selection. Namun diletakan sebelum Model Selection hanya untuk ilustrasi saja. Pada Praktiknya bisa langsung ke Model Selection.\n\n\n### Mendefinisikan model\n\nModel-model yang bisa digunakan dalam ekosistem `tidymodels` ada di dalam pacakge `parsnip`([read more](https://parsnip.tidymodels.org/)).Selain itu package turunan dari `parsnip`  seperti [`brulee`](https://brulee.tidymodels.org/) dan [`bonsai`](https://bonsai.tidymodels.org/) juga bisa digunakan.\n\nPackage `parsnip` menggunakan istilah `engine` untuk mengakses package asal dari model. Misalkan saja untuk model `decision_tree` kita bisa menggunakan package/engine `rpart` dan `C5.0` (dengan catatan kita harus menginstall package tersebut). Daftar lengkap package/engine yang bisa digunakan untuk `decision_tree` ada di [website `parsnip`](https://recipes.tidymodels.org). \n\nBerikut adalah ilustrasi penggunaanya\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntree_mod <- decision_tree() %>% \n            set_engine(engine = \"rpart\") %>% \n            set_mode(mode = \"classification\")\n```\n:::\n\n\n* fungsi `decision_tree` berarti kita ingin menggunakan model decision tree\n* fungsi `set_engine` digunakan untuk mengakses package/engine yang digunakan untuk model\n* fungsi `set_mode` digunakan untuk menentukan apakah problem yang dihadapi merupakan `classification` atau `regression`\n\n\n### Pembagian Data\n\nTahap pembagian data ini sangat bergantung pada package `rsample`([read more](https://rsample.tidymodels.org/index.html)). Metode-metode yang ada di dalam `rsample` adalah\n\na. Holdout Sample dengan fungsi `initial_split`\nb. Cross Validation dengan fungsi `vfold_cv`\nc. Group Cross Validation dengan fungsi `group_vfold_cv`\nd. Leave-One-Out Cross-Validation dengan fungsi `loo_cv`\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbasic_split <- initial_split(data = df,\n                             prop = 0.8,\n                             strata = \"class\")\n```\n:::\n\n\n* `data = df` untuk menentukan data yang akan dilakukan pembagian\n* `prop=0.8` proporsi pembagian yang dialokasikan ke data training\n* `strata = \"class\"` teknik sampling yang digunakan untuk melakukan pembagian adalah Stratified Random Sampling dengan didasarkan stratifikasi pada peubah respon `class`.\n\n\nBerikut adalah hasil pembagianya\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntidy(basic_split) %>% \n  count(Data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 2\n  Data           n\n  <chr>      <int>\n1 Analysis     800\n2 Assessment   200\n```\n:::\n:::\n\n\n\nTraining (Analysis) data yang kita dapatkan adalah 800 amatan atau $0.8 \\times 1000$, sedangkan Testing (Assessment) data yang didapatkan adalah 200 amatan atau $(1-0.8)*1000$.\n\n\nBerikut adalah sintaks untuk memesiahkan training data dan testing data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrain_df <- training(basic_split)\ndim(train_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 800  21\n```\n:::\n\n```{.r .cell-code}\ntest_df <- testing(basic_split)\ndim(test_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 200  21\n```\n:::\n:::\n\n\n\n* fungsi `training` berguna memisahkan training data dari data awal\n* fungsi `testing` berguna memisahkan testing data dari data awal\n\n\n### Model Training\n\nModel training bisa dilakukan dengan memanfaatkan fungsi `workflow` seperti dibawah ini:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntree_mod_trained <- workflow() %>% \n                    add_recipe(recipe = no_preproc) %>% \n                    add_model(spec = tree_mod) %>% \n                    fit(data=train_df)\n```\n:::\n\n\n* fungsi `add_recipe` digunakan untuk menambahkan tahap praproses data menggunakan package `recipe`\n* fungsi `add_model` digunakan untuk menambahkan model yang akan dilakukan training.\n* fungsi `fit` digunakan untuk menjalankan training.\n\n\n### Model Evaluation\n\n\n\n#### Prediksi Testing Data\n\n\nBerikut adalah sintaks mendapatkan prediksi testing data dalam bentuk kategori (`factor`)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npred_tree_mod <- tree_mod_trained %>% \n                  predict(new_data = test_df,type = \"class\")\n                  \npred_tree_mod \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 200 × 1\n   .pred_class\n   <fct>      \n 1 bad        \n 2 good       \n 3 bad        \n 4 good       \n 5 bad        \n 6 good       \n 7 good       \n 8 good       \n 9 good       \n10 good       \n# ℹ 190 more rows\n```\n:::\n:::\n\n\n* `type = \"class\"` argumen untuk mendapatkan prediksi dalam bentuk kategori (`factor`)\n* Pada dasarnya hasil prediksi dari tree berbentuk peluang, secara otomatis diubah menjadi kategori variabel respon dengan threshold=0.5\n\n\nBerikut adalah sintaks mendapatkan prediksi testing data dalam bentuk peluang\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprob_tree_mod <- tree_mod_trained %>% \n                  predict(new_data = test_df,type = \"prob\")\nprob_tree_mod\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 200 × 2\n   .pred_bad .pred_good\n       <dbl>      <dbl>\n 1     0.712      0.288\n 2     0.138      0.862\n 3     0.712      0.288\n 4     0.26       0.74 \n 5     0.712      0.288\n 6     0.229      0.771\n 7     0.138      0.862\n 8     0.26       0.74 \n 9     0.138      0.862\n10     0.138      0.862\n# ℹ 190 more rows\n```\n:::\n:::\n\n* `type = \"prob\"` argumen untuk mendapatkan prediksi dalam bentuk [kategori (`factor`) peluang\n\n#### Confussion Matrix\n\n\nBerikut adalah sintaks untuk menambahkan kolom variabel respon dari testing data\n\n\n::: {.cell}\n\n```{.r .cell-code}\npred_tree_mod <- pred_tree_mod %>% \n                 #menambahkan kolom truth\n                 mutate(truth=test_df$class)\npred_tree_mod\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 200 × 2\n   .pred_class truth\n   <fct>       <fct>\n 1 bad         bad  \n 2 good        good \n 3 bad         bad  \n 4 good        good \n 5 bad         bad  \n 6 good        good \n 7 good        good \n 8 good        good \n 9 good        good \n10 good        good \n# ℹ 190 more rows\n```\n:::\n:::\n\n\nSelanjutnya, kita akan mengeluarkan confussion matriks \n\n\n::: {.cell}\n\n```{.r .cell-code}\nconfussion_matrix <- pred_tree_mod %>%\n                      conf_mat(truth=truth,estimate=.pred_class)\n```\n:::\n\n\nConfusion matriks dapat ditampilkan dalam bentuk chart sebagai berikut:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nautoplot(confussion_matrix,type = \"heatmap\")+\n  scale_fill_gradient(low = \"#F4AFAB\",high = \"#EE847E\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nScale for fill is already present.\nAdding another scale for fill, which will replace the existing scale.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-29-1.png){width=672}\n:::\n:::\n\n\n\n* fungsi `autoplot` digunakan untuk mennampilkan confussion matrix\n* fungsi `scale_fill_gradient` digunakan untuk memberi warna pada confussion matrix\n* Berdasarkan output confussion matrix, terlihat bahwa sebagai hasil prediksi dari kategori `bad` banyak yang salah prediksi dibandingkan dengan hasil prediksi dari kategori `good`.\n\n\n#### Evaluasi model dengan metric \n\nPertama-tama, kita harus definsikan terlebih dahulu metrics yang kita gunakan. Metrics-metrics ini didapatkan dengan menggunakan package `yardstick`([read more](https://yardstick.tidymodels.org/)).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmulti_metric <- metric_set(accuracy,\n                           sensitivity,\n                           specificity,\n                           bal_accuracy,\n                           f_meas)\n```\n:::\n\n\n* fungsi `metric_set` digunakan untuk menyatukan beberapa metrik evaluasi.\n* `f_meas` adalah metrik f1-score\n\n\nBerikut adalah hasil evaluasi prediksi pada testing data menggunakan 5 metrik yang sudah didefinisikan\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npred_tree_mod %>%\n  #menambahkan kolom truth\n  mutate(truth=test_df$class) %>% \n  # evaluasi prediksi berdasarkan metrik\n  multi_metric(truth = truth,estimate = .pred_class)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 × 3\n  .metric      .estimator .estimate\n  <chr>        <chr>          <dbl>\n1 accuracy     binary         0.735\n2 sensitivity  binary         0.4  \n3 specificity  binary         0.879\n4 bal_accuracy binary         0.639\n5 f_meas       binary         0.475\n```\n:::\n:::\n\n\nKemudian, metrik `auc` dibawah ini digunakan untuk mengevaluasi prediksi dalam bentuk peluang.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprob_tree_mod %>%\n  mutate(truth=test_df$class) %>% \n  roc_auc(truth = truth,.pred_bad)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 3\n  .metric .estimator .estimate\n  <chr>   <chr>          <dbl>\n1 roc_auc binary         0.742\n```\n:::\n:::\n\n\n## Model Selection\n\n\nPada tahap ini kita bisa memilih model yang terbaik untuk kasus data kita. Beberapa langkah di tahap **Model Selection** sudah dijelaskan di **Model Training and Evaluation**. Sebagai ilustrasi kita akan membandingkan hasil model pohon, random forest dan regresi logistik.\n\n\n### Mendefinisikan model\n\n\nSeperti yang dijelaskan sebelumnya, model-model yang ada di package `parsnip` berasal dari package-package yang berbeda, berikut rinciannya:\n\n* Decision tree menggunakan package `rpart`\n* Random Forest menggunakan package `ranger`\n* Regresi Logistik menggunakan fungsi `glm` dari package `stats`\n\n\nBerikut adalah sintaks untuk mendefinsikan model, penjelasan detailnya sama seperti yang sebelumnya:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntree_mod <- decision_tree() %>%\n              set_engine(engine = \"rpart\") %>% \n              set_mode(mode = \"classification\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrf_mod <- rand_forest() %>% \n          set_engine(engine = \"ranger\",importance=\"impurity\") %>% \n          set_mode(mode = \"classification\")\n```\n:::\n\n\n* `importance=\"impurity\"` digunakan untuk mengekstrak variable importance dari random forest\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlr_mod <- logistic_reg() %>% \n          set_engine(engine = \"glm\") %>% \n          set_mode(mode = \"classification\")\n```\n:::\n\n\n\n### Pembagian Data\n\n\nPembagian data dilakukan dengan menggunakan metode **Cross Validation** dengan fungsi `vfold_cv`. Berikut sintaksnya:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfolds <- vfold_cv(data = df,v = 10,strata = \"class\")\n```\n:::\n\n\n\n* `v = 10` untuk menentukan banyaknya fold yang digunakan dalam **Cross Validation** adalah 10.\n* `strata = \"class\"` metode sampling yang digunakan adalah Stratified Random Sampling dengan stratifikasi berdasarkan kolom `class` yang berperan sebagai variabel respon.\n\n\n### Model Training and Evaluation\n\n\nModel Training and Evaluation akan dilakukan dengan bantuan fungsi `workflow_set` dan `workflow_map`. Kedua fungsi ini memungkinkan kita untuk melakukan pemilihan model terbaik berdasarkan metrik-metrik tertentu.\n\nFungsi `workflow_set` digunakan untuk menginput tahap praproses data dan model apa  yang digunakan. Sementara itu, fungsi `workflow_map` digunakan untuk menginputkan metode pembagian data dan metrik sekaligus **melakukan model training and evaluation**. Berikut adalah sintaksnya:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_selection_trained <- workflow_set(preproc = list(no=no_preproc,basic=basic_prepoc),\n                                      models = list(tree_mod,rf_mod,lr_mod),\n                                      cross = TRUE ) %>%\n                         workflow_map(fn = \"fit_resamples\",\n                                       resamples= folds,\n                                       metrics = multi_metric,\n                                       control = control_resamples(save_workflow = TRUE),\n                                       seed = 2045)\n```\n:::\n\n\n* argumen `preproc` digunakan untuk menginputkan tahap praproses data\n* sintaks `no=` dan `basic=` digunakan untuk memberi nama pada tahap praproses data\n* argumen `models` digunakan untuk menginputkan model\n* argumen `cross=TRUE` menandakan bahwa tahap praproses data dan model dipasangkan secara kombinasi. Sebagai ilustrasi tahap praproses data `basic` akan dipasangkan dengan model decision tree, random forest dan regresi logistik.\n* argumen `cross=TRUE` menandakan bahwa tahap praproses data dan model dipasangkan sesuai dengan urutanyan. Sebgai ilustrasi tahap praproses data `no` dipasangkan dengan decision. tree dan tahap praproses data `basic` akan dipasangkan dengan random forest. Semetara model regresi logistik tidak punya tahap praproses data sehingga akan menyebabkan `error`.\n* argumen `fn` digunakan untuk menentukan fungsi tidymodels yang akan digunakan.\n* argumen `resamples` digunakan untuk menginputkan metode pembagian data\n* argumen `metrics` digunakan untuk menginputkan metrik-metrik.\n* untuk argumen `control` bisa melihat help untuk lebih jelas.\n\n\nHasil training and evaluation pada sintaks sebelumnya disimpan dalam objek `mod_selection_trained`. Selanjutnya kita akan menampilkan hasilnya dengan menggunakan ranking.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncustom_output <- function(data){\n  data %>% \n  mutate(method = map_chr(wflow_id, ~ str_split(.x, \"_\",simplify = TRUE)[1])) %>% \n                        select(method,model,.metric,mean,std_err,rank)\n}\n\nmod_selection_result <- rank_results(mod_selection_trained,\n                                     rank_metric = \"bal_accuracy\") %>% \n                        custom_output()\n```\n:::\n\n\n* argumen `rank_metric` digunakan untuk menentukan metrik apa yang digunakan sebagai ranking. Dalam hal ini metrik yang digunakan adalah **balanced accuracy**\n* fungsi `custom_output` digunakan untuk mengkustomisasi output yang dihasilkan. Fungsi ini bisa tidak perlu dirubah-rubah.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_selection_result\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 30 × 6\n   method model        .metric       mean std_err  rank\n   <chr>  <chr>        <chr>        <dbl>   <dbl> <int>\n 1 no     logistic_reg accuracy     0.755 0.00477     1\n 2 no     logistic_reg bal_accuracy 0.682 0.00677     1\n 3 no     logistic_reg f_meas       0.549 0.0107      1\n 4 no     logistic_reg sensitivity  0.5   0.0165      1\n 5 no     logistic_reg specificity  0.864 0.00775     1\n 6 basic  logistic_reg accuracy     0.757 0.00790     2\n 7 basic  logistic_reg bal_accuracy 0.679 0.0105      2\n 8 basic  logistic_reg f_meas       0.543 0.0158      2\n 9 basic  logistic_reg sensitivity  0.483 0.0218      2\n10 basic  logistic_reg specificity  0.874 0.00971     2\n# ℹ 20 more rows\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_selection_result %>% \n  ggplot(aes(x = rank, y = mean, pch = method, col = model)) + \n  geom_point(cex = 3)+\n  facet_wrap(~.metric)+\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-40-1.png){width=672}\n:::\n:::\n\n\n\nBerdasarkan output diatas, kombinasi praproses data dan model yang menempati ranking 1 berdasarkan metrik **balanced accuracy** adalah `no`+`logistic_regression`. Sehingga model terbaik yang kita peroleh adalah `no`+`logistic_regression`.\n\n\n\n\n\nSetelah mendapatkan model terbaik kita bisa mengekstraknya model tersebut kemudian melakukan training ulang dengan seluruh data yang dimiliki menggunakan fungsi `fit_best` berikut ini\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbest_mod <- fit_best(x = mod_selection_trained,\n                     metric=\"bal_accuracy\")\nbest_mod\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n══ Workflow [trained] ══════════════════════════════════════════════════════════\nPreprocessor: Recipe\nModel: logistic_reg()\n\n── Preprocessor ────────────────────────────────────────────────────────────────\n0 Recipe Steps\n\n── Model ───────────────────────────────────────────────────────────────────────\n\nCall:  stats::glm(formula = ..y ~ ., family = stats::binomial, data = data)\n\nCoefficients:\n                                   (Intercept)  \n                                     1.2003826  \n                        checking_status'>=200'  \n                                     0.9656768  \n                     checking_status'0<=X<200'  \n                                     0.3748534  \n                  checking_status'no checking'  \n                                     1.7118880  \n                                      duration  \n                                    -0.0278633  \ncredit_history'critical/other existing credit'  \n                                     1.5791493  \n            credit_history'delayed previously'  \n                                     0.9965391  \n                 credit_history'existing paid'  \n                                     0.7294913  \n           credit_history'no credits/all paid'  \n                                     0.1433777  \n                              purpose'new car'  \n                                    -0.5227827  \n                             purpose'used car'  \n                                     1.1436842  \n                               purposebusiness  \n                                     0.2173041  \n                              purposeeducation  \n                                    -0.5590666  \n                    purposefurniture/equipment  \n                                     0.2688276  \n                                  purposeother  \n                                     0.9660032  \n                               purposeradio/tv  \n                                     0.3688007  \n                                purposerepairs  \n                                    -0.3063868  \n                             purposeretraining  \n                                     1.5366500  \n                                 credit_amount  \n                                    -0.0001283  \n                        savings_status'>=1000'  \n                                     1.3391988  \n                    savings_status'100<=X<500'  \n                                     0.3577406  \n                   savings_status'500<=X<1000'  \n                                     0.3760729  \n              savings_status'no known savings'  \n                                     0.9466892  \n\n...\nand 56 more lines.\n```\n:::\n:::\n\n\nuntuk memastikan training data yang digunakan adalah seluruh data yang kita miliki, kita bisa menggunakan fungsi dibawah ini:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nextract_recipe(best_mod)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n── Recipe ──────────────────────────────────────────────────────────────────────\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n── Inputs \n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nNumber of variables by role\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\noutcome:    1\npredictor: 20\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n── Training information \n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nTraining data contained 1000 data points and no incomplete rows.\n```\n:::\n:::\n\n\n\n\n## Model Interpretability (Explainability)\n\n\nTahap ini meruapakan tahap untuk mengerti bagaimana variabel-variabel prediktor berpengaruh terhadap prediksi berdasarkan **model terbaik** yang diperoleh pada tahap model selection.\n\n\n## Model Terbaik\n\nKarena model terbaik adalah regresi logistik maka kita bisa menggunakan nilai koefisien dari regresi logistik untuk memahami bagaimana variabel-variabel prediktor berpengaruh terhadap prediksi.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntidy(best_mod,exponentiate=TRUE) %>% \n  mutate(across(where(is.numeric),~round(.x,3)))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 49 × 5\n   term                                     estimate std.error statistic p.value\n   <chr>                                       <dbl>     <dbl>     <dbl>   <dbl>\n 1 (Intercept)                                 3.32      1.42      0.845   0.398\n 2 checking_status'>=200'                      2.63      0.369     2.62    0.009\n 3 checking_status'0<=X<200'                   1.46      0.218     1.72    0.085\n 4 checking_status'no checking'                5.54      0.232     7.37    0    \n 5 duration                                    0.973     0.009    -3.00    0.003\n 6 credit_history'critical/other existing …    4.85      0.438     3.60    0    \n 7 credit_history'delayed previously'          2.71      0.47      2.12    0.034\n 8 credit_history'existing paid'               2.07      0.385     1.89    0.058\n 9 credit_history'no credits/all paid'         1.15      0.549     0.261   0.794\n10 purpose'new car'                            0.593     0.762    -0.686   0.493\n# ℹ 39 more rows\n```\n:::\n:::\n\n\n\n### Tambahan\n\nDibawah ini adalah ilustrasi tambahan model interpretability untuk decision tree dan random forest.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Retraining decision tree dengan seluruh data\ntree_mod_trained <- workflow() %>% \n                    add_recipe(recipe = no_preproc) %>% \n                    add_model(spec = tree_mod) %>% \n                    fit(data=df)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nextract_fit_engine(tree_mod_trained) %>% \n    rpart.plot(type = 2,extra = 106,\n               faclen = -1,\n               box.palette =blues9[-8:-9] ,\n               tweak = 1.4)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Cannot retrieve the data used to build the model (so cannot determine roundint and is.binary for the variables).\nTo silence this warning:\n    Call rpart.plot with roundint=FALSE,\n    or rebuild the rpart model with model=TRUE.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-45-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Retraining Random Forest dengan seluruh data\nrf_mod_trained <- workflow() %>% \n                    add_recipe(recipe = no_preproc) %>% \n                    add_model(spec = rf_mod) %>% \n                    fit(data=df)\n```\n:::\n\n\n\nfungsi `plot_importance` merupakan fungsi bantuan yang tidak perlu dirubah-rubah.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_importance<- function(rf){\n  rf %>% \n  ranger::importance() %>% \n  as.data.frame() %>% \n  rownames_to_column(\"Variables\") %>% \n  rename(\"impurity\"=\".\") %>% \n  arrange(impurity) %>% \n  mutate(Variables=factor(Variables,levels=Variables)) %>% \n  ggplot(aes(Variables,impurity))+\n  geom_col(fill=\"#03A9F4\")+\n  coord_flip()+\n  theme_classic()+\n  theme(axis.line.y = element_blank(),\n        axis.ticks.y = element_blank(),\n        axis.title.y = element_blank() )+\n  scale_y_continuous(expand = c(0,0))\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nextract_fit_engine(rf_mod_trained) %>% \n  plot_importance()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-48-1.png){width=672}\n:::\n:::\n\n\n\n\n\n## Model Deployment\n\n\nPada tahap ini kita akan menggunakan model untuk keperluan prediksi data baru. Hal pertama yang mungkin kita bisa lakukan adalah menyimpan model terbaik ke file berbentuk `rds` sehingga kita bisa menggunakanya tanpa perlu running sintaks dari awal. Tahap penyimpanan ini **tidak wajib** untuk dilakukan\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsaveRDS(best_mod,file = \"credit_model.rds\")\n```\n:::\n\n\nSintaks diatas berarti kita menyimpan model terbaik dalam file bernama `credit_model.rds`.\n\n\n\n### Prediksi Data Baru\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(2045)\ndata_baru_dummy <- df %>% \n                   slice_sample(n=7) %>% \n                   select(-class)\ndata_baru_dummy\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  checking_status duration                   credit_history\n1   'no checking'       12                  'existing paid'\n2            '<0'       15                  'existing paid'\n3            '<0'       24                  'existing paid'\n4            '<0'       24                       'all paid'\n5            '<0'       18                  'existing paid'\n6            '<0'       21             'delayed previously'\n7   'no checking'       36 'critical/other existing credit'\n               purpose credit_amount     savings_status employment\n1            'new car'          1386      '500<=X<1000'   '1<=X<4'\n2 'domestic appliance'          1275 'no known savings'   '1<=X<4'\n3            'new car'           915 'no known savings'      '>=7'\n4  furniture/equipment          3552             '<100'   '4<=X<7'\n5            'new car'           976             '<100'       '<1'\n6            education          3414             '<100'       '<1'\n7             business          6304 'no known savings'      '>=7'\n  installment_commitment      personal_status other_parties residence_since\n1                      2 'female div/dep/mar'          none               2\n2                      4 'female div/dep/mar'          none               2\n3                      4 'female div/dep/mar'          none               2\n4                      3        'male single'          none               4\n5                      1 'female div/dep/mar'          none               2\n6                      2        'male single'          none               1\n7                      4        'male single'          none               4\n  property_magnitude age other_payment_plans housing existing_credits\n1   'life insurance'  26                none     own                1\n2                car  24                none    rent                1\n3                car  29                bank     own                1\n4                car  27                bank     own                1\n5                car  23                none     own                1\n6   'life insurance'  26                none     own                2\n7      'real estate'  36                none     own                2\n                   job num_dependents own_telephone foreign_worker\n1              skilled              1          none            yes\n2              skilled              1          none            yes\n3              skilled              1          none            yes\n4              skilled              1          none            yes\n5 'unskilled resident'              1          none            yes\n6              skilled              1          none            yes\n7              skilled              1          none            yes\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_pred <- readRDS(\"credit_model.rds\") %>% \n              predict(new_data = data_baru_dummy,type = \"class\")\nnew_pred\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 7 × 1\n  .pred_class\n  <fct>      \n1 good       \n2 bad        \n3 bad        \n4 bad        \n5 bad        \n6 bad        \n7 good       \n```\n:::\n:::\n\n\nsintaks `readRDS(\"credit_model.rds\")` untuk meload model terbaik yang sudah kita simpan.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite.csv(x = new_pred,file = \"submission.csv\",row.names = F)\n```\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}